<!--
CO_OP_TRANSLATOR_METADATA:
{
  "original_hash": "b5466bcedc3c75aa35476270362f626a",
  "translation_date": "2025-05-20T01:52:40+00:00",
  "source_file": "15-rag-and-vector-databases/data/frameworks.md",
  "language_code": "ja"
}
-->
# ニューラルネットワークフレームワーク

すでに学んだように、ニューラルネットワークを効率的に訓練するためには、次の2つのことを行う必要があります：

* テンソルを操作すること、例：乗算、加算、シグモイドやソフトマックスなどの関数を計算すること
* 勾配降下法による最適化を行うために、すべての表現の勾配を計算すること

`numpy` ライブラリは最初の部分を行うことができますが、勾配を計算するためのメカニズムが必要です。前のセクションで開発したフレームワークでは、`backward` メソッド内で手動で全ての導関数をプログラムしなければなりませんでした。理想的には、フレームワークは私たちが定義できる*任意の表現*の勾配を計算する機会を提供すべきです。

もう一つ重要なのは、GPUやTPUなどの特化した計算ユニットで計算を行う能力を持つことです。ディープニューラルネットワークの訓練には*非常に多くの*計算が必要であり、GPU上でそれらの計算を並列化する能力は非常に重要です。

> ✅ 「並列化」という用語は、計算を複数のデバイスに分散させることを意味します。

現在、最も人気のある2つのニューラルフレームワークは、TensorFlowとPyTorchです。どちらもCPUとGPU上でテンソルを操作するための低レベルAPIを提供しています。低レベルAPIの上には、高レベルAPIもあり、それぞれKerasとPyTorch Lightningと呼ばれています。

低レベルAPI | TensorFlow | PyTorch
--------------|-------------------------------------|--------------------------------
高レベルAPI | Keras | PyTorch Lightning

**低レベルAPI** は、いわゆる**計算グラフ**を構築することができます。このグラフは、与えられた入力パラメータで出力（通常は損失関数）を計算する方法を定義し、GPUで計算を行うためにプッシュすることができます。計算グラフを微分し、勾配を計算するための関数があり、それらはモデルパラメータの最適化に使用できます。

**高レベルAPI** は、ニューラルネットワークを**層の連続**として考え、ほとんどのニューラルネットワークの構築を非常に簡単にします。モデルの訓練には通常、データの準備を行い、`fit` 関数を呼び出して作業を行います。

高レベルAPIは、典型的なニューラルネットワークを非常に迅速に構築することができ、多くの詳細を気にせずに済みます。一方、低レベルAPIは訓練プロセスに対するより多くのコントロールを提供し、新しいニューラルネットワークアーキテクチャを扱う研究においてよく使用されます。

また、両方のAPIを組み合わせて使用することができることを理解することも重要です。例えば、低レベルAPIを使用して独自のネットワーク層アーキテクチャを開発し、それを高レベルAPIで構築・訓練された大きなネットワーク内で使用することができます。また、高レベルAPIを使用して層の連続としてネットワークを定義し、独自の低レベル訓練ループを使用して最適化を行うこともできます。両方のAPIは同じ基本的な概念を使用し、互いにうまく連携するように設計されています。

## 学習

このコースでは、PyTorchとTensorFlowの両方のコンテンツを提供しています。お好みのフレームワークを選択し、対応するノートブックを通して学習してください。どちらのフレームワークを選ぶべきか迷った場合は、**PyTorch vs. TensorFlow**に関するインターネット上の議論を読んでみてください。また、両方のフレームワークを見て理解を深めることもできます。

可能な限り、高レベルAPIを使用してシンプルにします。ただし、ニューラルネットワークがどのように動作するかを基礎から理解することが重要だと考えているため、最初は低レベルAPIとテンソルを使用して作業を開始します。しかし、これらの詳細を学ぶのに時間をかけたくない場合は、それをスキップして高レベルAPIのノートブックに進むこともできます。

## ✍️ 演習: フレームワーク

以下のノートブックで学習を続けてください：

低レベルAPI | TensorFlow+Kerasノートブック | PyTorch
--------------|-------------------------------------|--------------------------------
高レベルAPI | Keras | *PyTorch Lightning*

フレームワークをマスターした後、過剰適合の概念を再確認しましょう。

# 過剰適合

過剰適合は機械学習において非常に重要な概念であり、正しく理解することが非常に重要です！

以下の5つの点（グラフ上では `x` で表される）を近似する問題を考えてみましょう：

!linear | overfit
-------------------------|--------------------------
**線形モデル、2つのパラメータ** | **非線形モデル、7つのパラメータ**
訓練誤差 = 5.3 | 訓練誤差 = 0
検証誤差 = 5.1 | 検証誤差 = 20

* 左側では、良い直線近似が見られます。パラメータの数が適切であるため、モデルは点の分布の背後にあるアイデアを正しく捉えています。
* 右側では、モデルが強力すぎます。5つの点しかないのに、モデルが7つのパラメータを持っているため、すべての点を通過するように調整することができ、訓練誤差を0にします。しかし、これによりデータの背後にある正しいパターンを理解することができず、検証誤差が非常に高くなります。

モデルの豊かさ（パラメータの数）と訓練サンプルの数の間で適切なバランスを取ることが非常に重要です。

## なぜ過剰適合が起こるのか

  * 訓練データが不足している
  * モデルが強力すぎる
  * 入力データにノイズが多すぎる

## 過剰適合の検出方法

上のグラフからわかるように、過剰適合は非常に低い訓練誤差と高い検証誤差によって検出できます。通常、訓練中には訓練誤差と検証誤差の両方が減少し始め、その後ある時点で検証誤差が減少を止めて上昇し始めることがあります。これが過剰適合の兆候であり、この時点で訓練を停止するべき（または少なくともモデルのスナップショットを作成するべき）という指標になります。

過剰適合

## 過剰適合を防ぐ方法

過剰適合が起こっていることがわかる場合は、次のいずれかを行うことができます：

 * 訓練データの量を増やす
 * モデルの複雑さを減らす
 * 後で考慮するDropoutなどの正則化技術を使用する

## 過剰適合とバイアス-分散トレードオフ

過剰適合は、統計におけるより一般的な問題であるバイアス-分散トレードオフの一例です。モデルの誤差の可能性のある原因を考えると、2種類の誤差が見えます：

* **バイアス誤差** は、アルゴリズムが訓練データとの関係を正しく捉えることができないことによって引き起こされます。モデルが強力でないために発生することがあります（**過小適合**）。
* **分散誤差** は、モデルが入力データのノイズを意味のある関係ではなく近似することによって引き起こされます（**過剰適合**）。

訓練中、バイアス誤差は減少し（モデルがデータを近似することを学ぶため）、分散誤差は増加します。過剰適合を防ぐために訓練を停止することが重要です - 手動で（過剰適合を検出した場合）または正則化を導入して自動的に。

## 結論

このレッスンでは、最も人気のあるAIフレームワークであるTensorFlowとPyTorchの様々なAPIの違いについて学びました。さらに、非常に重要なトピックである過剰適合についても学びました。

## 🚀 チャレンジ

付属のノートブックでは、下部に「タスク」があります。ノートブックを通して作業し、タスクを完了してください。

## レビューと自己学習

次のトピックについて調査を行ってください：

- TensorFlow
- PyTorch
- 過剰適合

次の質問を自問してください：

- TensorFlowとPyTorchの違いは何ですか？
- 過剰適合と過小適合の違いは何ですか？

## 課題

このラボでは、PyTorchまたはTensorFlowを使用して単層および多層の完全結合ネットワークを使用した2つの分類問題を解決するよう求められます。

**免責事項**:  
この文書はAI翻訳サービス[Co-op Translator](https://github.com/Azure/co-op-translator)を使用して翻訳されています。正確さを期していますが、自動翻訳には誤りや不正確さが含まれる場合がありますのでご注意ください。原文の言語による文書を権威ある情報源と見なすべきです。重要な情報については、専門の人間による翻訳をお勧めします。この翻訳の使用により生じる誤解や誤訳について、当社は責任を負いません。